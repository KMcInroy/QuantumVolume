(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     29795,        769]
NotebookOptionsPosition[     29302,        751]
NotebookOutlinePosition[     29839,        771]
CellTagsIndexPosition[     29796,        768]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"Dir", "=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\n", 
 RowBox[{"Import", "[", "\"\<https://qtechtheory.org/questlink.m\>\"", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CreateDownloadedQuESTEnv", "[", "]"}], ";"}], "\n", 
 RowBox[{"Get", "[", 
  RowBox[{"StringJoin", "[", 
   RowBox[{"Dir", ",", "\"\<VQD CG V3 Parallel.wl\>\""}], "]"}], "]"}], "\n", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Import", "[", "\"\<BV12Q.csv\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"VQD", " ", "Initialisation"}], "*)"}], 
  RowBox[{"locations", "=", 
   RowBox[{"Association", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"#1", "->", "#2"}], "&"}], "@@@", 
     RowBox[{"Transpose", "@", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", "12"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"5", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"5", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "0", ",", "0"}], "}"}]}], "}"}]}], "}"}]}]}], 
    "]"}]}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "0"}], "}"}]}], "}"}], "}"}], "]"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RydbergHub", "]"}], "=", 
   RowBox[{"{", "\n", 
    RowBox[{"(*", " ", 
     RowBox[{"The", " ", "total", " ", "number", " ", "of", " ", 
      RowBox[{"atoms", "/", "qubit"}]}], "*)"}], "\n", 
    RowBox[{
     RowBox[{"QubitNum", " ", "->", "  ", "13"}], "\n", ",", "\n", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Physical", " ", "location", " ", "on", " ", "each", " ", "qubit", " ",
         "described", " ", "with", " ", "a", " ", "2", "D"}], "-", " ", 
       RowBox[{"or", " ", "3", "D"}], "-", "vector"}], "*)"}], "\n", 
     RowBox[{"AtomLocations", " ", "->", " ", "locations"}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"It", "'"}], "s", " ", "presumed", " ", "that", " ", 
       RowBox[{
        RowBox[{"Subscript", "[", 
         RowBox[{"T", ",", " ", "2"}], "]"}], "^"}], "*", " ", "has", " ", 
       "been", " ", "echoed", " ", "out", " ", "to", " ", 
       RowBox[{"Subscript", "[", 
        RowBox[{"T", ",", " ", "2"}], "]"}]}], " ", "*)"}], "\n", 
     RowBox[{"T2", " ", "->", " ", 
      RowBox[{"1.49", "*", 
       RowBox[{"10", "^", "6"}]}]}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "The", " ", "life", " ", "time", " ", "of", " ", "vacuum", " ", 
        "chamber"}], ",", " ", 
       RowBox[{
        RowBox[{
        "where", " ", "it", " ", "affects", " ", "the", " ", "coherence", " ", 
         RowBox[{"time", ":", " ", "T1"}]}], "=", 
        RowBox[{"\[Tau]vac", "/", "N"}]}]}], "  ", "*)"}], "\n", 
     RowBox[{"VacLifeTime", " ", "->", " ", 
      RowBox[{"4", "*", 
       RowBox[{"10", "^", "6"}]}]}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Rabi", " ", "frequency", " ", "of", " ", "the", " ", 
        RowBox[{"atoms", ".", " ", "We"}], " ", "assume", " ", "the", " ", 
        "duration", " ", "of", " ", "multi"}], "-", 
       RowBox[{
       "qubit", " ", "gates", " ", "is", " ", "as", " ", "long", " ", "as", 
        " ", "4", "\[Pi]", " ", "pulse", " ", "of", " ", "single"}], "-", 
       RowBox[{"qubit", " ", "gates"}]}], " ", "*)"}], "\n", 
     RowBox[{"RabiFreq", " ", "->", " ", "1"}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Asymmetric", " ", "bit"}], "-", 
        RowBox[{"flip", " ", "error", " ", "probability"}]}], ";", " ", 
       RowBox[{
       "the", " ", "error", " ", "is", " ", "acquired", " ", "during", " ", 
        "single", " ", "qubit", " ", "operation"}]}], " ", "*)"}], "\n", 
     RowBox[{"ProbBFRot", " ", "->", " ", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"10", "->", "0"}], ",", " ", 
        RowBox[{"01", "->", "0"}]}], "|>"}]}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{"Unit", " ", "lattice", " ", "in", " ", 
       RowBox[{"\[Mu]m", ".", " ", "This"}], " ", "will", " ", "be", " ", 
       "the", " ", "unit", " ", "the", " ", "lattice", " ", "and", " ", 
       "coordinates"}], " ", "*)"}], "\n", 
     RowBox[{"UnitLattice", " ", "->", " ", "1"}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "blockade", " ", "radius", " ", "of", " ", "each", " ", "atom"}], " ", 
      "*)"}], "\n", 
     RowBox[{"BlockadeRadius", " ", "->", " ", "10"}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "The", " ", "factor", " ", "that", " ", "estimates", " ", 
        "accelerated", " ", "dephasing", " ", "due", " ", "to", " ", "moving",
         " ", "the", " ", 
        RowBox[{"atoms", ".", " ", "Ideally"}]}], ",", " ", 
       RowBox[{
       "it", " ", "is", " ", "calculated", " ", "from", " ", "the", " ", 
        "distance", " ", "and", " ", 
        RowBox[{"speed", "."}]}]}], " ", "*)"}], "\n", 
     RowBox[{"HeatFactor", " ", "->", " ", "0"}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Leakage", " ", "probability", " ", "during", " ", "initalisation", " ",
        "process"}], " ", "*)"}], "\n", 
     RowBox[{"ProbLeakInit", " ", "->", 
      RowBox[{"(*", " ", "0.007", "*)"}], "0.003"}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"duration", " ", "of", " ", "moving", " ", "atoms"}], ";", " ", 
       RowBox[{
       "we", " ", "assume", " ", "SWAPLoc", " ", "and", " ", "ShiftLoc", " ", 
        "take", " ", "this", " ", "amount", " ", "of", " ", 
        RowBox[{"time", ":", " ", 
         RowBox[{"100", " ", "\[Mu]s"}]}]}]}], " ", "*)"}], "\n", 
     RowBox[{"DurMove", " ", "->", " ", "100"}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "duration", " ", "of", " ", "lattice", " ", "initialization", " ", 
       "which", " ", "involves", " ", "the", " ", "atom", " ", "loading", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"~", "50"}], "%"}], ")"}], " ", "and", " ", "rearranging", 
       " ", "the", " ", "optical", " ", "tweezer"}], " ", "*)"}], "\n", 
     RowBox[{"DurInit", " ", "->", " ", "300"}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"measurement", " ", "fidelity", " ", "and", " ", "duration"}], 
       ",", " ", 
       RowBox[{
       "were", " ", "it", " ", "induces", " ", "atom", " ", "loss", " ", 
        "afterward"}]}], " ", "*)"}], "\n", 
     RowBox[{"FidMeas", " ", "->", " ", "100"}], "\n", ",", "\n", 
     RowBox[{"DurMeas", " ", "->", " ", 
      RowBox[{"2", "*", 
       RowBox[{"10", "^", "4"}]}]}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "The", " ", "increasing", " ", "probability", " ", "of", " ", "atom", 
       " ", "loss", " ", "on", " ", "each", " ", 
       RowBox[{"measurement", ".", " ", "The"}], " ", "value", " ", "keeps", 
       " ", "increasing", " ", "until", " ", "being", " ", "initialised"}], 
      " ", "*)"}], "\n", 
     RowBox[{"ProbLossMeas", " ", "->", " ", "0"}], "\n", ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "leak", " ", "probability", " ", "of", " ", "implementing", " ", 
        "multi"}], "-", 
       RowBox[{"qubit", " ", "gates"}]}], " ", "*)"}], "\n", 
     RowBox[{"ProbLeakCZ", " ", "->", " ", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"01", "->", " ", "0.001"}], ",", 
        RowBox[{"11", "->", "0.001"}]}], " ", "|>"}]}]}], "\n", "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RydDev", "=", 
    RowBox[{"RydbergHub", "[", "]"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"Defining", " ", "key", " ", "functions"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Fraction", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
   RowBox[{"a", "/", "b"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Defining", " ", 
    RowBox[{"QuEST", "'"}], "s", " ", "Rydberg", " ", "Blockade", " ", 
    "Check", " ", "in", " ", "a", " ", "permanent", " ", "function", " ", 
    "such", " ", "that", " ", "it", " ", "can", " ", "be", " ", "used", " ", 
    "without", " ", "constantly", " ", "editing", " ", "the", " ", "code"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"distloc", "[", 
     RowBox[{"q1_", ",", " ", "q2_"}], "]"}], " ", ":=", " ", "\n", "\t\t\t", 
    RowBox[{
     RowBox[{"Norm", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"RydDev", "[", "AtomLocations", "]"}], "[", "q1", "]"}], " ",
         "-", " ", 
        RowBox[{
         RowBox[{"RydDev", "[", "AtomLocations", "]"}], "[", "q2", "]"}]}], 
       ",", " ", "2"}], "]"}], " ", 
     RowBox[{"RydDev", "[", "UnitLattice", "]"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"blockadecheck", "[", "q_List", "]"}], " ", ":=", " ", "\n", 
   "\t\t\t", 
   RowBox[{"And", " ", "@@", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"distloc", " ", "@@", " ", "#"}], " ", "<=", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"RydDev", "[", "BlockadeRadius", "]"}], "+", 
           "$MachineEpsilon"}], ")"}]}], ")"}], "&"}], " ", "/@", " ", 
      RowBox[{"Subsets", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "q", "]"}], ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"KetList", "[", "NQ_", "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"ToExpression", "@", 
      RowBox[{"StringSplit", "[", 
       RowBox[{
        RowBox[{"IntegerString", "[", 
         RowBox[{"i", ",", "2", ",", "NQ"}], "]"}], ",", "\"\<\>\""}], 
       "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "0", ",", 
       RowBox[{
        RowBox[{"2", "^", "NQ"}], "-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
  "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Translating", " ", "imported", " ", "Qiskit", " ", "circuits", " ", 
    "into", " ", "appropraite", " ", "QuEST", " ", "notation"}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Dynamic", " ", "reconfiguration", " ", "for", " ", "connectivity", " ", 
     "requirements"}], ",", " ", 
    RowBox[{
    "modelled", " ", "as", " ", "a", " ", "40", "\[Mu]s", " ", "wait", " ", 
     "between", " ", "operations", " ", "on", " ", "the", " ", "moved", " ", 
     "qubit", " ", "to", " ", "apply", " ", "passive", " ", "noise"}]}], 
   "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"CircuitTranslator", "[", "DataSet_", "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"CircSplit", "=", 
      RowBox[{"DataSet", "[", 
       RowBox[{"[", 
        RowBox[{"i", ",", 
         RowBox[{"3", ";;", 
          RowBox[{
           RowBox[{"DataSet", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], "+", "2"}]}]}], "]"}], 
       "]"}]}], ";", 
     RowBox[{"CZCount", "=", "0"}], ";", "\n", 
     RowBox[{"ZonesMoved", "=", "0"}], ";", "\n", 
     RowBox[{"TransCirc", "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{"Init", ",", " ", "j"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "0", ",", 
            RowBox[{
             RowBox[{"userconfig", "[", "NQubits", "]"}], "-", "1"}]}], 
           "}"}]}], "]"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"GateSplit", "=", 
             RowBox[{"StringSplit", "[", 
              RowBox[{
               RowBox[{"CircSplit", "[", 
                RowBox[{"[", "j", "]"}], "]"}], ",", "\"\<, [\>\""}], "]"}]}],
             ";", "\n", 
            RowBox[{"GateName", "=", 
             RowBox[{"StringTrim", "[", 
              RowBox[{
               RowBox[{"StringTrim", "[", 
                RowBox[{
                 RowBox[{"GateSplit", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<[\>\""}], "]"}], 
               ",", "\"\<'\>\""}], "]"}]}], ";", "\n", 
            RowBox[{"GateQubits", "=", 
             RowBox[{"IntegerPart", "[", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"StringSplit", "[", 
                RowBox[{
                 RowBox[{"StringTrim", "[", 
                  RowBox[{
                   RowBox[{"GateSplit", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<]\>\""}], "]"}],
                  ",", "\"\<,\>\""}], "]"}], "]"}], "]"}]}], ";", "\n", 
            RowBox[{"GateParameters", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"StringContainsQ", "[", 
                RowBox[{"GateName", ",", "\"\<C\>\""}], "]"}], ",", "Pi", ",", 
               RowBox[{"Pi", "*", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"StringReplace", "[", 
                  RowBox[{
                   RowBox[{"StringTrim", "[", 
                    RowBox[{
                    RowBox[{"GateSplit", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", "\"\<]]\>\""}], 
                    "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<(\>\"", "->", "\"\<[\>\""}], ",", 
                    RowBox[{"\"\<)\>\"", "->", "\"\<]\>\""}]}], "}"}]}], 
                  "]"}], "]"}]}]}], "]"}]}], ";", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "GateQubits", "]"}], "==", "2"}], ",", 
              RowBox[{
               RowBox[{"CZCount", "+=", "1"}], ";", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"GateQubits", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "<=", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"userconfig", "[", "NQubits", "]"}], "-", "1"}], 
                    ")"}], "-", 
                   RowBox[{"6", "*", 
                    RowBox[{"(", 
                    RowBox[{"ZonesMoved", "+", "1"}], ")"}]}]}]}], ",", 
                 RowBox[{
                  RowBox[{"MoveSize", "=", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"userconfig", "[", "NQubits", "]"}], "-", "1"}], 
                    ")"}], "-", 
                    RowBox[{"Ceiling", "[", 
                    RowBox[{
                    RowBox[{"GateQubits", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "6"}], "]"}]}], 
                    ")"}], "/", "2"}]}], ";", 
                  RowBox[{"ZonesMoved", "+=", 
                   RowBox[{"MoveSize", "/", "3"}]}], ";", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Subscript", "[", 
                    RowBox[{"Wait", ",", " ", "0"}], "]"}], "[", "40", "]"}], 
                    ",", 
                    RowBox[{"Subscript", "[", 
                    RowBox[{"CZPI", ",", 
                    RowBox[{"GateQubits", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"GateQubits", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}]}], ",", 
                 RowBox[{"Subscript", "[", 
                  RowBox[{"CZPI", ",", 
                   RowBox[{"GateQubits", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"GateQubits", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Subscript", "[", 
                RowBox[{
                 RowBox[{"ToExpression", "[", "GateName", "]"}], ",", " ", 
                 RowBox[{"GateQubits", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
               "GateParameters", "]"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"DataSet", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "]"}]}], "]"}]}], ";", "\n", "TransCirc"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "DataSet", "]"}]}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Circs", "=", 
    RowBox[{"CircuitTranslator", "[", "data", "]"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Routine", " ", "to", " ", "apply", " ", "circuits", " ", "and", " ", 
    "extract", " ", "populations", " ", "from", " ", "the", " ", "density", 
    " ", "matrix"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BVCircuitApplier", "[", 
    RowBox[{"Circs_", ",", "Nq_"}], "]"}], ":=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Rho]", "=", 
       RowBox[{"CreateDensityQureg", "[", "13", "]"}]}], ";", "\n", 
      RowBox[{"ApplyCircuit", "[", 
       RowBox[{"\[Rho]", ",", 
        RowBox[{"ExtractCircuit", "[", 
         RowBox[{"InsertCircuitNoise", "[", 
          RowBox[{
           RowBox[{"Circs", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", "RydDev", ",", 
           RowBox[{"ReplaceAliases", "->", "True"}]}], "]"}], "]"}]}], "]"}], 
      ";", "\n", 
      RowBox[{"ProbsAllStates", "=", 
       RowBox[{"CalcProbOfAllOutcomes", "[", 
        RowBox[{"\[Rho]", ",", 
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", "12"}], "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{"RenormProbs", "=", 
       RowBox[{"Total", "[", 
        RowBox[{"CalcProbOfAllOutcomes", "[", 
         RowBox[{"\[Rho]", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "12"}], "]"}]}], "]"}], "]"}]}], ";", "\n", 
      RowBox[{"RenormProbsAllStates", "=", 
       RowBox[{"ProbsAllStates", "/", "RenormProbs"}]}], ";", "\n", 
      RowBox[{"DestroyAllQuregs", "[", "]"}], ";", "\n", 
      RowBox[{"{", 
       RowBox[{
       "ProbsAllStates", ",", "RenormProbs", ",", "RenormProbsAllStates"}], 
       "}"}]}], ",", "\n", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "Circs", "]"}]}], "}"}]}], "]"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Routine", " ", "to", " ", "splice", " ", "dataset", " ", "circuits", " ",
      "according", " ", "to", " ", "number", " ", "of", " ", "qubits", " ", 
     "required"}], ",", " ", 
    RowBox[{
    "then", " ", "apply", " ", "appropriate", " ", "circuits", " ", "to", " ",
      "the", " ", "register"}]}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"For", " ", "NQ"}], ">=", "10"}], ",", " ", 
    RowBox[{
    "we", " ", "use", " ", "a", " ", "random", " ", "sample", " ", "of", " ", 
     "the", " ", "available", " ", "circuits"}], ",", " ", 
    RowBox[{
    "always", " ", "including", " ", "the", " ", "first", " ", "and", " ", 
     "last", " ", "of", " ", "the", " ", "set"}], ",", " ", 
    RowBox[{
    "to", " ", "allow", " ", "for", " ", "efficient", " ", "computation"}], 
    ",", " ", 
    RowBox[{
    "as", " ", "the", " ", "number", " ", "of", " ", "possible", " ", 
     "circuits", " ", "doubles", " ", "for", " ", "each", " ", "extra", " ", 
     "qubit"}]}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Returns", " ", "raw", " ", "probabilities"}], ",", " ", 
    RowBox[{
    "renormalised", " ", "probabilites", " ", "to", " ", "account", " ", 
     "for", " ", "qubit", " ", "loss"}], ",", " ", 
    RowBox[{
    "and", " ", "probability", " ", "of", " ", "qubit", " ", "loss"}]}], 
   "*)"}]}], "\n", 
 RowBox[{"i", "=", 
  RowBox[{"Total", "[", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"2", "^", "NQ"}], ",", 
     RowBox[{"{", 
      RowBox[{"NQ", ",", "2", ",", "8"}], "}"}]}], "]"}], "]"}]}], "\n", 
 RowBox[{"RES", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Print", "[", "Nq", "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Nq", ">=", "10"}], ",", 
       RowBox[{
        RowBox[{"LowestGateCirc", "=", 
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"2", "^", "nqcount"}], ",", 
             RowBox[{"{", 
              RowBox[{"nqcount", ",", "2", ",", 
               RowBox[{"Nq", "-", "2"}]}], "}"}]}], "]"}], "]"}], "+", 
          "1"}]}], ";", " ", "\n", "       ", 
        RowBox[{"HighestGateCirc", "=", 
         RowBox[{"Total", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"2", "^", "nqcount"}], ",", 
            RowBox[{"{", 
             RowBox[{"nqcount", ",", "2", ",", 
              RowBox[{"Nq", "-", "1"}]}], "}"}]}], "]"}], "]"}]}], ";", "\n", 
        "                    ", 
        RowBox[{"Data", "=", 
         RowBox[{"BVCircuitApplier", "[", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Circs", "[", 
               RowBox[{"[", "LowestGateCirc", "]"}], "]"}], "}"}], ",", 
             RowBox[{"RandomSample", "[", 
              RowBox[{
               RowBox[{"Circs", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ";;", 
                  RowBox[{"i", "+", 
                   RowBox[{"2", "^", 
                    RowBox[{"(", 
                    RowBox[{"Nq", "-", "1"}], ")"}]}], "-", "2"}]}], "]"}], 
                "]"}], ",", "254"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"Circs", "[", 
               RowBox[{"[", "HighestGateCirc", "]"}], "]"}], "}"}]}], "]"}], 
           ",", "Nq"}], "]"}]}]}], ",", "    ", "\n", "       ", 
       RowBox[{"Data", "=", 
        RowBox[{"BVCircuitApplier", "[", 
         RowBox[{
          RowBox[{"Circs", "[", 
           RowBox[{"[", 
            RowBox[{"i", ";;", 
             RowBox[{"i", "+", 
              RowBox[{"2", "^", 
               RowBox[{"(", 
                RowBox[{"Nq", "-", "1"}], ")"}]}], "-", "1"}]}], "]"}], "]"}],
           ",", "Nq"}], "]"}]}]}], "]"}], ";", "\n", "        ", 
     RowBox[{"Probs", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Mean", "[", 
         RowBox[{"Max", "@@@", 
          RowBox[{"Data", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"StandardDeviation", "[", 
          RowBox[{"Max", "@@@", 
           RowBox[{"Data", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], "/", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"Length", "[", 
           RowBox[{"Max", "@@@", 
            RowBox[{"Data", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], "]"}]}]}], 
       "}"}]}], ";", " ", 
     RowBox[{"ProbsRenorm", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Mean", "[", 
         RowBox[{"Max", "@@@", 
          RowBox[{"Data", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{"Mean", "[", 
            RowBox[{"Max", "@@@", 
             RowBox[{"Data", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}]}], "]"}], "]"}], "/", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"Max", "@@@", 
             RowBox[{"Data", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}]}], "]"}], "]"}]}], "*", 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"StandardDeviation", "[", 
               RowBox[{"Max", "@@@", 
                RowBox[{"Data", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], "/", 
              RowBox[{"Mean", "[", 
               RowBox[{"Max", "@@@", 
                RowBox[{"Data", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], ")"}], 
            "^", "2"}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"StandardDeviation", "[", 
               RowBox[{"Data", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "/", 
              RowBox[{"Mean", "[", 
               RowBox[{"Data", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ")"}], "^",
             "2"}], "-", 
           RowBox[{"2", "*", 
            RowBox[{
             RowBox[{"Covariance", "[", 
              RowBox[{
               RowBox[{"Max", "@@@", 
                RowBox[{"Data", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"Data", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Mean", "[", 
                RowBox[{"Max", "@@@", 
                 RowBox[{"Data", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], "*", 
               RowBox[{"Mean", "[", 
                RowBox[{"Data", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], 
              ")"}]}]}]}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"StandardDeviation", "[", 
          RowBox[{"Max", "@@@", 
           RowBox[{"Data", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}]}], "]"}], "/", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"Length", "[", 
           RowBox[{"Max", "@@@", 
            RowBox[{"Data", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "3"}], "]"}], "]"}]}], "]"}], "]"}]}]}], 
       "}"}]}], ";", 
     RowBox[{"PLoss", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "-", 
         RowBox[{"Mean", "[", 
          RowBox[{"Data", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"StandardDeviation", "[", 
          RowBox[{"Data", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "/", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"Length", "[", 
           RowBox[{"Data", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "]"}]}]}], 
       "}"}]}], ";", "\n", 
     RowBox[{"i", "=", 
      RowBox[{"i", "+", 
       RowBox[{"2", "^", 
        RowBox[{"(", 
         RowBox[{"Nq", "-", "1"}], ")"}]}]}]}], ";", "\n", 
     RowBox[{"Print", "[", 
      RowBox[{"{", 
       RowBox[{"Probs", ",", "ProbsRenorm", ",", "PLoss"}], "}"}], "]"}], ";",
      "\n", 
     RowBox[{"{", 
      RowBox[{"Probs", ",", "ProbsRenorm", ",", "PLoss"}], "}"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"Nq", ",", "2", ",", "13"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{"Export", "[", 
  RowBox[{"\"\<BVPI.csv\>\"", ",", "RES"}], "]"}], "\n"}], "Input",
 CellChangeTimes->{{3.9083860807666693`*^9, 
  3.908386087825786*^9}},ExpressionUUID->"ed5a89f0-4dd2-4f7e-9215-\
10265a5ab2cb"]
},
WindowSize->{582.6, 494.4},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules->Association[
 "CodeFormatter" -> 
  Association[
   "ToolbarState" -> False, "ToolbarAccentColor" -> RGBColor["#2497b7"]]],
FrontEndVersion->"12.3 for Microsoft Windows (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"1310d282-3931-4c98-8bfb-cd460fecd71d"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 28740, 729, 3511, "Input",ExpressionUUID->"ed5a89f0-4dd2-4f7e-9215-10265a5ab2cb"]
}
]
*)

